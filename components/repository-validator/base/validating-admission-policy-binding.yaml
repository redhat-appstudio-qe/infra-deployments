apiVersion: admissionregistration.k8s.io/v1
kind: ValidatingAdmissionPolicyBinding
metadata:
  name: repository-url-validator-binding
spec:
  policyName: repository-url-validator
  validationActions: [Deny, Audit]
  paramRef:
    namespace: repository-validator
    parameterNotFoundAction: Deny
    selector:
      matchLabels:
        app.kubernetes.io/name: repository-validator
  # Apply to all namespaces except system namespaces
  matchResources:
    namespaceSelector:
      matchExpressions:
      - key: kubernetes.io/metadata.name
        operator: NotIn
        values:
        - kube-system
        - kube-public
        - kube-node-lease
        - repository-validator
